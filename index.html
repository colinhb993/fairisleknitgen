<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fair Isle Star Band</title>
  <style>
    body {
      background: #000000;
      font-family: sans-serif;
      text-align: center;
      color: #fff;
    }
    canvas {
      margin: 10px;
      border-radius: 8px;
      image-rendering: pixelated; /* crisp edges */
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      border: 1px solid #01e49a;
      border-radius: 8px;
      cursor: pointer;
      background: #000000;
      color: #01e49a;
      font-size: 1rem;
    }
    button:hover {
      background: #01e49a;
      color: #000000;
    }
  </style>
</head>
<body>
  <canvas id="bandPattern" width="675" height="135"></canvas>
  <br>
  <div>
    <button onclick="giveFeedback('nnn')">👎👎👎</button>
    <button onclick="giveFeedback('nn')">👎👎</button>
    <button onclick="giveFeedback('n')">👎</button>
    <button onclick="startPattern()">▶️ Start</button>
    <button onclick="giveFeedback('y')">👍</button>
    <button onclick="giveFeedback('yy')">👍👍</button>
    <button onclick="giveFeedback('yyy')">👍👍👍</button>
  </div>

<script>
// -----------------------------
// CONFIG
// -----------------------------
const teal = "#01e49a";
const black = "#000000";
const tileSize = 27;   // Smaller grid like Python
const pixelScale = 5;  // Scale factor per pixel
const repeats = 5;

// -----------------------------
// RANDOM STAR PARAMETERS
// -----------------------------
function randomStarParams() {
  return {
    numPoints: Math.floor(Math.random() * 5) + 6, // 6-10
    layers: Math.floor(Math.random() * 3) + 3,    // 3-5
    rotation: Math.random() * Math.PI / 10,       // small rotation
    sprinkleChance: Math.random() * 0.15          // sprinkle small extras
  };
}

// -----------------------------
// GENERATE STAR GRID
// -----------------------------
function generateStarPattern(size, params) {
  const grid = Array.from({length: size}, () => Array(size).fill(0));
  const center = Math.floor(size / 2);
  const maxRadius = center * 0.9;

  for (let i = 0; i <= center; i++) {
    for (let j = 0; j <= center; j++) {
      const dx = i;
      const dy = j;
      const r = Math.sqrt(dx*dx + dy*dy);
      const angle = Math.atan2(dy, dx) + params.rotation;

      const starVal = (Math.sin(angle * params.numPoints) + 1)/2;
      const ringBand = Math.floor((r / maxRadius) * params.layers);

      let val = 0;
      if (r < maxRadius && starVal > 0.65 && (ringBand % 2 === 0 || (ringBand === 1 && Math.random() < 0.7))) {
        val = 1;
      }
      // Sprinkles
      if (r < maxRadius*0.85 && Math.random() < params.sprinkleChance) val = 1;
      // Satellites
      if (starVal > 0.85 && Math.random() < 0.25) val = 1;

      // Mirror to four quadrants
      grid[center + i][center + j] = val;
      grid[center + i][center - j] = val;
      grid[center - i][center + j] = val;
      grid[center - i][center - j] = val;
    }
  }
  return grid;
}

// -----------------------------
// DRAW BAND
// -----------------------------
function drawBand(grid, canvasId, repeats) {
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext("2d");
  const size = grid.length;

  canvas.width = size * pixelScale * repeats;
  canvas.height = size * pixelScale;

  ctx.fillStyle = black;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  for (let r = 0; r < repeats; r++) {
    for (let y = 0; y < size; y++) {
      for (let x = 0; x < size; x++) {
        if (grid[y][x] === 1) {
          ctx.fillStyle = teal;
          ctx.fillRect(r*size*pixelScale + x*pixelScale, y*pixelScale, pixelScale, pixelScale);
        }
      }
    }
  }
}

// -----------------------------
// MAIN LOOP
// -----------------------------
let currentParams = null;

function startPattern() {
  currentParams = randomStarParams();
  const grid = generateStarPattern(tileSize, currentParams);
  drawBand(grid, "bandPattern", repeats);
}

function giveFeedback(resp) {
  if (!currentParams) {
    console.log("No pattern yet — press Start first.");
    return;
  }
  console.log("Feedback:", resp, "for params:", currentParams);
  currentParams = randomStarParams();
  const grid = generateStarPattern(tileSize, currentParams);
  drawBand(grid, "bandPattern", repeats);
}
</script>
</body>
</html>
