<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fair Isle Star Band</title>
  <style>
    body {
      background: #000000;
      font-family: sans-serif;
      text-align: center;
      color: #fff;
    }
    canvas {
      margin: 10px;
      border-radius: 8px;
      image-rendering: pixelated; /* sharp edges */
    }
    button {
      margin: 5px;
      padding: 10px 15px;
      border: 1px solid #01e49a;
      border-radius: 8px;
      cursor: pointer;
      background: #000000;
      color: #01e49a;
      font-size: 1rem;
    }
    button:hover {
      background: #01e49a;
      color: #000000;
    }
  </style>
</head>
<body>
  <canvas id="bandPattern" width="1000" height="200"></canvas>
  <br>
  <div>
    <button onclick="giveFeedback('nnn')">👎👎👎</button>
    <button onclick="giveFeedback('nn')">👎👎</button>
    <button onclick="giveFeedback('n')">👎</button>
    <button onclick="startPattern()">▶️ Start</button>
    <button onclick="giveFeedback('y')">👍</button>
    <button onclick="giveFeedback('yy')">👍👍</button>
    <button onclick="giveFeedback('yyy')">👍👍👍</button>
  </div>

<script>
// -----------------------------
// CONFIG
// -----------------------------
const teal = "#01e49a";
const black = "#000000";
const tileSize = 41;   // Odd for symmetry
const pixelScale = 5;  // Scale factor per pixel for rendering

// -----------------------------
// RANDOM STAR GRID GENERATOR
// -----------------------------
function randomStarParams() {
  return {
    numPoints: Math.floor(Math.random() * 4) + 6,  // 6–9 points
    layers: Math.floor(Math.random() * 3) + 2,     // 2–4 layers
    rotation: Math.random() * Math.PI / 6,         // slight random rotation
    sprinkleChance: Math.random() * 0.15           // chance for small extras
  };
}

function generateStarPattern(size, params) {
  const grid = Array.from({ length: size }, () => Array(size).fill(0));
  const center = Math.floor(size / 2);

  for (let i = 0; i <= center; i++) {
    for (let j = 0; j <= center; j++) {
      const dx = i, dy = j;
      const distance = Math.sqrt(dx * dx + dy * dy);
      const angle = Math.atan2(dy, dx) + params.rotation;

      // Star function
      const starValue = Math.sin(angle * params.numPoints) * Math.cos(distance / (size / params.layers));
      const val = starValue > 0.3 ? 1 : 0;

      // Sprinkle extras
      const finalVal = (val || Math.random() < params.sprinkleChance) ? 1 : 0;

      // Mirror to all four quadrants
      grid[center + i][center + j] = finalVal;
      grid[center + i][center - j] = finalVal;
      grid[center - i][center + j] = finalVal;
      grid[center - i][center - j] = finalVal;
    }
  }
  return grid;
}

// -----------------------------
// DRAW BAND
// -----------------------------
function drawBand(grid, canvasId, repeats) {
  const canvas = document.getElementById(canvasId);
  const ctx = canvas.getContext("2d");
  const size = grid.length;

  ctx.fillStyle = black;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  for (let r = 0; r < repeats; r++) {
    for (let x = 0; x < size; x++) {
      for (let y = 0; y < size; y++) {
        if (grid[y][x] === 1) {
          ctx.fillStyle = teal;
          ctx.fillRect(r * size * pixelScale + x * pixelScale, y * pixelScale, pixelScale, pixelScale);
        }
      }
    }
  }
}

// -----------------------------
// MAIN LOOP
// -----------------------------
let currentParams = null;

function startPattern() {
  currentParams = randomStarParams();
  const grid = generateStarPattern(tileSize, currentParams);
  drawBand(grid, "bandPattern", 5);
}

function giveFeedback(resp) {
  if (!currentParams) {
    console.log("No pattern yet — press Start first.");
    return;
  }
  console.log("Feedback:", resp, "for params:", currentParams);
  // For now, just regenerate a new one
  currentParams = randomStarParams();
  const grid = generateStarPattern(tileSize, currentParams);
  drawBand(grid, "bandPattern", 5);
}

</script>
</body>
</html>
